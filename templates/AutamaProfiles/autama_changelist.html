{% extends 'admin/change_list.html' %}

{% block object-tools %}
    <div class= "inprog" id="inprog">In progress: </div> <br>
    <div>
        <input type="text" id="count" name="count" maxlength="4" size="4">
        <button style="margin-left: 10px;" type="button" id="submitmass">Mass Produce</button>
{#        <form action="massproduce/" method="POST">#}
{#            {% csrf_token %}#}
{#                <button type="submit">Mass-produce</button>#}
{#        </form>#}
    </div>
    <br />
    {{ block.super }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
    <script>

    document.getElementById("submitmass").addEventListener("click", function () {
        $.post("massproduce/",
            {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                count: $("#count").val(),
            }, function (data, status) {
                console.log(data.test);
                if (status === 500) {
                    alert("Error: " + data.error);
                }
        });
    });

    inprogget();

    // Poll the inprogress count every 5s
    $(document).ready(function() {
        setInterval(inprogget, 10000);
    });

    // Update in progress count
    function inprogget() {
        $.get("/AutamaProfiles/inprogress", function(data, status) {
            $('#inprog').text("In progress: " + data.inprogress);
        });
    }

    </script>
{% endblock %}